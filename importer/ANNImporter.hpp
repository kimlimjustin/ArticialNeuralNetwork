//-------------------------------------------------------------
//【文件名】ANNImporter.hpp
//【功能模块和目的】ANN格式神经网络模型导入器声明
//【开发者及日期】林钲凯 2025-07-27
//【更改记录】
//-------------------------------------------------------------

#ifndef AnnImporter_hpp
#define AnnImporter_hpp

#include "BaseImporter.hpp"
#include "../model/activation_functions/ActivationFunction.hpp"
#include <fstream>
#include <vector>

using namespace std;

//-------------------------------------------------------------
//【类名】ANNImporter
//【功能】ANN文件格式导入器，解析神经网络结构
//【说明】支持ANN文件的网络、层、神经元、突触解析
//【开发者及日期】林钲凯 2025-07-27
//【更改记录】
//-------------------------------------------------------------
class ANNImporter : public BaseImporter {
private:
    //-------------------------------------------------------------
    //【函数名称】parseNetworkHeader
    //【函数功能】解析网络头部信息
    //【参数】file：输入文件流，network：要填充的网络对象
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseNetworkHeader(ifstream& file, Network& network);
    
    //-------------------------------------------------------------
    //【函数名称】parseLayerInformation
    //【函数功能】解析层信息
    //【参数】file：输入文件流，network：要填充的网络对象
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseLayerInformation(ifstream& file, Network& network);
    
    //-------------------------------------------------------------
    //【函数名称】parseNeuronInformation
    //【函数功能】解析神经元信息
    //【参数】file：输入文件流，layer：要填充的层对象，neuronCount：神经元数量
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseNeuronInformation(ifstream& file, Layer& layer, int neuronCount);
    
    //-------------------------------------------------------------
    //【函数名称】parseConnections
    //【函数功能】解析突触连接信息
    //【参数】file：输入文件流，network：要更新连接的网络对象
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseConnections(ifstream& file, Network& network);
    
    //-------------------------------------------------------------
    //【函数名称】skipWhitespaceAndComments
    //【函数功能】跳过文件中的空白符和注释
    //【参数】file：输入文件流
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    void skipWhitespaceAndComments(ifstream& file);
    
    //-------------------------------------------------------------
    //【函数名称】readToken
    //【函数功能】从文件中读取下一个标记
    //【参数】file：输入文件流
    //【返回值】string，读取的标记字符串
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    string readToken(ifstream& file);
    
    //-------------------------------------------------------------
    //【函数名称】parseActivationFunction
    //【函数功能】根据名称解析激活函数
    //【参数】functionName：激活函数名称
    //【返回值】unique_ptr<ActivationFunction>，激活函数对象指针
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    unique_ptr<ActivationFunction> parseActivationFunction(const string& functionName);
    
    //-------------------------------------------------------------
    //【函数名称】createNeuronWithActivation
    //【函数功能】根据激活函数类型创建神经元
    //【参数】bias：偏置值，activationType：激活函数类型
    //【返回值】unique_ptr<Neuron>，创建的神经元指针
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    unique_ptr<Neuron> createNeuronWithActivation(double bias, int activationType);
    
    //-------------------------------------------------------------
    //【函数名称】findNeuronByGlobalIndex
    //【函数功能】根据全局索引查找神经元
    //【参数】network：网络引用，globalIndex：全局索引
    //【返回值】Neuron*，找到的神经元指针，未找到返回nullptr
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    Neuron* findNeuronByGlobalIndex(Network& network, int globalIndex);

public:
    //-------------------------------------------------------------
    //【函数名称】ANNImporter
    //【函数功能】构造函数
    //【参数】无
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    ANNImporter();
    
    //-------------------------------------------------------------
    //【函数名称】ANNImporter（拷贝构造）
    //【函数功能】拷贝构造函数
    //【参数】other：被拷贝的ANN导入器
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    ANNImporter(const ANNImporter& other) = default;
    
    //-------------------------------------------------------------
    //【函数名称】operator=
    //【函数功能】赋值运算符重载
    //【参数】other：赋值来源ANN导入器
    //【返回值】ANNImporter&，自身引用
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    ANNImporter& operator=(const ANNImporter& other) = default;
    
    //-------------------------------------------------------------
    //【函数名称】~ANNImporter
    //【函数功能】析构函数
    //【参数】无
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    ~ANNImporter();
    
    //-------------------------------------------------------------
    //【函数名称】importNetwork
    //【函数功能】从ANN文件导入神经网络
    //【参数】filename：ANN文件路径
    //【返回值】unique_ptr<Network>，导入的网络对象指针
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    unique_ptr<Network> importNetwork(const string& filename) override;
    
    //-------------------------------------------------------------
    //【函数名称】getSupportedExtensions
    //【函数功能】获取支持的文件扩展名
    //【参数】无
    //【返回值】string，返回".ann"
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    string getSupportedExtensions() const override;
    
    //-------------------------------------------------------------
    //【函数名称】getImporterName
    //【函数功能】获取导入器名称
    //【参数】无
    //【返回值】string，返回"ANN Importer"
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    string getImporterName() const override;
};

#endif // AnnImporter_hpp
