//-------------------------------------------------------------
//【文件名】ANNImporter.h
//【功能模块和目的】ANN格式神经网络模型导入器声明
//【开发者及日期】林钲凯 2025-07-27
//【更改记录】
//-------------------------------------------------------------

#ifndef ANN_IMPORTER_H
#define ANN_IMPORTER_H

#include "BaseImporter.h"
#include <fstream>
#include <vector>

//-------------------------------------------------------------
//【类名】ANNImporter
//【功能】ANN文件格式导入器，解析神经网络结构
//【说明】支持ANN文件的网络、层、神经元、突触解析
//【开发者及日期】林钲凯 2025-07-27
//【更改记录】
//-------------------------------------------------------------
class ANNImporter : public BaseImporter {
private:
    //-------------------------------------------------------------
    //【函数名称】parseNetworkHeader
    //【函数功能】解析网络头部信息
    //【参数】file：输入文件流，network：要填充的网络对象
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseNetworkHeader(std::ifstream& file, Network& network);
    
    //-------------------------------------------------------------
    //【函数名称】parseLayerInformation
    //【函数功能】解析层信息
    //【参数】file：输入文件流，network：要填充的网络对象
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseLayerInformation(std::ifstream& file, Network& network);
    
    //-------------------------------------------------------------
    //【函数名称】parseNeuronInformation
    //【函数功能】解析神经元信息
    //【参数】file：输入文件流，layer：要填充的层对象，neuronCount：神经元数量
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseNeuronInformation(std::ifstream& file, Layer& layer, int neuronCount);
    
    //-------------------------------------------------------------
    //【函数名称】parseConnections
    //【函数功能】解析突触连接信息
    //【参数】file：输入文件流，network：要更新连接的网络对象
    //【返回值】bool，成功解析返回true
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    bool parseConnections(std::ifstream& file, Network& network);
    
    //-------------------------------------------------------------
    //【函数名称】skipWhitespaceAndComments
    //【函数功能】跳过文件中的空白符和注释
    //【参数】file：输入文件流
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    void skipWhitespaceAndComments(std::ifstream& file);
    
    //-------------------------------------------------------------
    //【函数名称】readToken
    //【函数功能】从文件中读取下一个标记
    //【参数】file：输入文件流
    //【返回值】std::string，读取的标记字符串
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    std::string readToken(std::ifstream& file);
    
    //-------------------------------------------------------------
    //【函数名称】parseActivationFunction
    //【函数功能】根据名称解析激活函数
    //【参数】functionName：激活函数名称
    //【返回值】std::unique_ptr<ActivationFunction>，激活函数对象指针
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    std::unique_ptr<ActivationFunction> parseActivationFunction(const std::string& functionName);
    
    //-------------------------------------------------------------
    //【函数名称】findNeuronByGlobalIndex
    //【函数功能】根据全局索引查找神经元
    //【参数】network：网络引用，globalIndex：全局索引
    //【返回值】Neuron*，找到的神经元指针，未找到返回nullptr
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    Neuron* findNeuronByGlobalIndex(Network& network, int globalIndex);

public:
    //-------------------------------------------------------------
    //【函数名称】ANNImporter
    //【函数功能】构造函数
    //【参数】无
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    ANNImporter();
    
    //-------------------------------------------------------------
    //【函数名称】~ANNImporter
    //【函数功能】析构函数
    //【参数】无
    //【返回值】无
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    ~ANNImporter();
    
    //-------------------------------------------------------------
    //【函数名称】importNetwork
    //【函数功能】从ANN文件导入神经网络
    //【参数】filename：ANN文件路径
    //【返回值】std::unique_ptr<Network>，导入的网络对象指针
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    std::unique_ptr<Network> importNetwork(const std::string& filename) override;
    
    //-------------------------------------------------------------
    //【函数名称】getSupportedExtensions
    //【函数功能】获取支持的文件扩展名
    //【参数】无
    //【返回值】std::string，返回".ann"
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    std::string getSupportedExtensions() const override;
    
    //-------------------------------------------------------------
    //【函数名称】getImporterName
    //【函数功能】获取导入器名称
    //【参数】无
    //【返回值】std::string，返回"ANN Importer"
    //【开发者及日期】林钲凯 2025-07-27
    //【更改记录】
    //-------------------------------------------------------------
    std::string getImporterName() const override;
};

#endif // ANN_IMPORTER_H
